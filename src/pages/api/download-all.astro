<script>
  import express from "express";
  import archiver from "archiver";
  import path from "path";

  const app = express();

  app.get("/api/download-all", (req, res) => {
    const modsDirectory = path.join(process.cwd(), "/mods");
    const archive = archiver("zip", { zlib: { level: 9 } });

    res.setHeader("Content-Type", "application/zip");
    res.setHeader("Content-Disposition", 'attachment; filename="mods.zip"');

    archive.on("error", (err) => res.status(500).send({ error: err.message }));
    archive.pipe(res);

    archive.directory(modsDirectory, false);
    archive.finalize();
  });

  app.listen(3000, () =>
    console.log("Server running on http://localhost:3000")
  );
</script>
